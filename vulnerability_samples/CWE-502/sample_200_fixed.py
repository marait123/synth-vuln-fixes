import json
import os
import sys

def manage_product_inventory(action, product_info, file_name):
    if not os.path.isfile(file_name):
        with open(file_name, 'w') as file:
            json.dump({'inventory': {}}, file)
    
    with open(file_name, 'r+') as file:
        data = json.load(file)
        inventory = data['inventory']
        if action == 'add':
            product_id = product_info['id']
            inventory[product_id] = product_info
        elif action == 'remove':
            product_id = product_info['id']
            if product_id in inventory:
                del inventory[product_id]
        elif action == 'update':
            product_id = product_info['id']
            inventory[product_id].update(product_info)
        file.seek(0)
        json.dump(data, file)
        file.truncate()

def display_inventory(file_name):
    if not os.path.isfile(file_name):
        print("Inventory is empty.")
        return
    
    with open(file_name, 'r') as file:
        data = json.load(file)
        inventory = data['inventory']
        if not inventory:
            print("Inventory is empty.")
        else:
            print("Current Inventory:")
            for product_id, product_info in inventory.items():
                print(f"ID: {product_id}, Name: {product_info['name']}, Quantity: {product_info['quantity']}")

def search_product(file_name, search_term):
    if not os.path.isfile(file_name):
        return []
    
    with open(file_name, 'r') as file:
        data = json.load(file)
        inventory = data['inventory']
        results = []
        for product_id, product_info in inventory.items():
            if search_term.lower() in product_info['name'].lower():
                results.append(product_info)
        return results

def get_product_info():
    product_id = input("Enter product ID: ")
    name = input("Enter product name: ")
    quantity = int(input("Enter quantity: "))
    price = float(input("Enter price: "))
    return {'id': product_id, 'name': name, 'quantity': quantity, 'price': price}

def main():
    file_name = 'inventory.json'
    while True:
        print("\n1. Add Product\n2. Remove Product\n3. Update Product\n4. Display Inventory\n5. Search Product\n6. Exit")
        choice = input("Enter your choice (1-6): ")
        
        if choice == '1':
            product_info = get_product_info()
            manage_product_inventory('add', product_info, file_name)
            print("Product added successfully.")
        elif choice == '2':
            product_id = input("Enter product ID to remove: ")
            manage_product_inventory('remove', {'id': product_id}, file_name)
            print("Product removed successfully.")
        elif choice == '3':
            product_info = get_product_info()
            manage_product_inventory('update', product_info, file_name)
            print("Product updated successfully.")
        elif choice == '4':
            display_inventory(file_name)
        elif choice == '5':
            search_term = input("Enter search term: ")
            results = search_product(file_name, search_term)
            if results:
                print("Search Results:")
                for product in results:
                    print(f"ID: {product['id']}, Name: {product['name']}, Quantity: {product['quantity']}")
            else:
                print("No products found.")
        elif choice == '6':
            print("Exiting program.")
            sys.exit(0)
        else:
            print("Invalid choice. Please try again.")

if __name__ == "__main__":
    main()