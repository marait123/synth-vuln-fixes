import cherrypy
import defusedxml.ElementTree as ET
import json

class InventoryManager:
    def __init__(self):
        self.inventory = {}

    @cherrypy.expose
    def index(self):
        return "Welcome to Inventory Manager"

    @cherrypy.expose
    def update_inventory(self, xml_data):
        try:
            inventory = ET.parse(xml_data)  # Fixed line
            root = inventory.getroot()
            for item in root.findall('item'):
                item_id = item.get('id')
                name = item.find('name').text
                quantity = int(item.find('quantity').text)
                self.inventory[item_id] = {'name': name, 'quantity': quantity}
            return "Inventory updated successfully"
        except Exception as e:
            return f"Error updating inventory: {str(e)}"

    @cherrypy.expose
    def add_item(self, item_id, name, quantity):
        try:
            quantity = int(quantity)
            self.inventory[item_id] = {'name': name, 'quantity': quantity}
            return f"Item {item_id} added successfully"
        except ValueError:
            return "Invalid quantity. Please enter a number."

    @cherrypy.expose
    def remove_item(self, item_id):
        if item_id in self.inventory:
            del self.inventory[item_id]
            return f"Item {item_id} removed successfully"
        else:
            return f"Item {item_id} not found in inventory"

    @cherrypy.expose
    def list_inventory(self):
        return json.dumps(self.inventory)

    @cherrypy.expose
    def get_item(self, item_id):
        if item_id in self.inventory:
            return json.dumps(self.inventory[item_id])
        else:
            return f"Item {item_id} not found in inventory"

    @cherrypy.expose
    def update_quantity(self, item_id, quantity):
        try:
            quantity = int(quantity)
            if item_id in self.inventory:
                self.inventory[item_id]['quantity'] = quantity
                return f"Quantity updated for item {item_id}"
            else:
                return f"Item {item_id} not found in inventory"
        except ValueError:
            return "Invalid quantity. Please enter a number."

if __name__ == '__main__':
    cherrypy.quickstart(InventoryManager())