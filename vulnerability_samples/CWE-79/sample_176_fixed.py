from django.db import models
from django.shortcuts import render, redirect
from django.views import View
from django import forms
from django.utils.html import escape

class FeedbackModel(models.Model):
    email = models.EmailField()
    feedback = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)

class FeedbackForm(forms.ModelForm):
    class Meta:
        model = FeedbackModel
        fields = ['email', 'feedback']

    def clean_email(self):
        email = self.cleaned_data['email']
        return escape(email)

    def clean_feedback(self):
        feedback = self.cleaned_data['feedback']
        return escape(feedback)

class FeedbackSubmissionView(View):
    template_name = 'feedback_form.html'
    success_template = 'feedback_success.html'

    def get(self, request):
        form = FeedbackForm()
        return render(request, self.template_name, {'form': form})

    def post(self, request):
        form = FeedbackForm(request.POST)
        if form.is_valid():
            feedback = form.save()
            return render(request, self.success_template, {'feedback': feedback})
        return render(request, self.template_name, {'form': form})

class FeedbackListView(View):
    template_name = 'feedback_list.html'

    def get(self, request):
        feedbacks = FeedbackModel.objects.all().order_by('-created_at')
        return render(request, self.template_name, {'feedbacks': feedbacks})

# URLs configuration
from django.urls import path

urlpatterns = [
    path('submit/', FeedbackSubmissionView.as_view(), name='submit_feedback'),
    path('list/', FeedbackListView.as_view(), name='list_feedback'),
]

# Templates
# feedback_form.html
"""
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Submit Feedback</button>
</form>
"""

# feedback_success.html
"""
<h1>Thank you for your feedback!</h1>
<p>We appreciate your input, {{ feedback.email }}</p>
<p>Your feedback: {{ feedback.feedback }}</p>
"""

# feedback_list.html
"""
<h1>Submitted Feedback</h1>
<ul>
{% for feedback in feedbacks %}
    <li>{{ feedback.email }}: {{ feedback.feedback }}</li>
{% endfor %}
</ul>
"""